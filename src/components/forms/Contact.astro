---
import Button from "@components/ui/Button.astro";
import Checkbox from "@components/ui/form/Checkbox.astro";
import Input from "@components/ui/form/Input.astro";
import Radio from "@components/ui/form/Radio.astro";
import Textarea from "@components/ui/form/Textarea.astro";

const hearAboutOptions = [
    { label: "Búsqueda navegador", value: "search" },
    { label: "Google maps", value: "maps" },
    { label: "Redes sociales", value: "social" },
    { label: "Amigo/Colega", value: "referral" },
    { label: "Otro", value: "other" }
];

const interestOptions = [
    { label: "Desarrollo Web", value: "web" },
    { label: "Desarrollo Móvil", value: "mobile" },
    { label: "Servicios de Diseño", value: "design" },
    { label: "Consultoría", value: "consulting" }
];

const serviceOptions = [
    { label: "Desarrollo de Sitio Web", value: "website" },
    { label: "Desarrollo de App Móvil", value: "mobile" },
    { label: "Diseño UI/UX", value: "design" },
    { label: "Marketing Digital", value: "marketing" },
    { label: "Consultoría", value: "consulting" }
];

const budgetOptions = [
    { label: "$5,000 - $10,000", value: "5-10k" },
    { label: "$10,000 - $25,000", value: "10-25k" },
    { label: "$25,000 - $50,000", value: "25-50k" },
    { label: "$50,000+", value: "50k+" }
];

const formBackground = 'light';
---
<form class="space-y-6 bg-white p-6 rounded-lg" id="contact-form">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <Input
        label="Nombre"
        id="name"
        name="name"
        required
        background={formBackground}
        />
        <Input
        label="Correo electrónico"
        type="email"
        id="email"
        name="email"
        required
        background={formBackground}
        />
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <Input
        label="Teléfono"
        type="tel"
        id="phone"
        name="phone"
        background={formBackground}
    />
    <Input
        label="Empresa"
        id="company"
        name="company"
        background={formBackground}
    />
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <Radio
            label="¿Cómo se enteró de nosotros?"
            id="hear-about"
            name="hear-about"
            options={hearAboutOptions}
            required
            background={formBackground}
        />
    <!-- <Checkbox
        label="Áreas de interés"
        id="interests"
        name="interests"
        options={interestOptions}
        background={formBackground}
    /> -->
    </div>
    
    <Textarea
        label="Mensaje"
        id="message"
        name="message"
        required
        background={formBackground}
    />
    
    <Checkbox
        label="Acepto los términos y condiciones"
        id="terms"
        name="terms"
        required
        background={formBackground}
    />
    
    <!-- <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <Select
            label="¿Qué servicio le interesa?"
            id="service"
            name="service"
            options={serviceOptions}
            required
            placeholder="Elija un servicio"
            background={formBackground}
        />
        <Select
            label="Rango de presupuesto"
            id="budget"
            name="budget"
            options={budgetOptions}
            required
            placeholder="Seleccione su presupuesto"
            background={formBackground}
        />
    </div> -->

    <div id="form-message" class="hidden p-4 rounded-lg"></div>

    <div class="mt-6">
        <Button type="submit">Enviar</Button>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contact-form');
    const messageDiv = document.getElementById('form-message');
    
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const submitButton = form.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;
        
        // Mostrar estado de carga
        submitButton.disabled = true;
        submitButton.textContent = 'Enviando...';
        messageDiv.classList.add('hidden');
        
        try {
            const formData = new FormData(form);
            
            const response = await fetch('/api/contact', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                showMessage('Mensaje enviado correctamente. Te contactaremos pronto.', 'success');
                form.reset();
            } else {
                showMessage(result.error || 'Error al enviar el mensaje. Inténtalo de nuevo.', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showMessage('Error de conexión. Inténtalo de nuevo.', 'error');
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = originalText;
        }
    });
    
    function showMessage(text, type) {
        messageDiv.textContent = text;
        messageDiv.classList.remove('hidden');
        
        if (type === 'success') {
            messageDiv.classList.remove('bg-red-100', 'text-red-700', 'border-red-200');
            messageDiv.classList.add('bg-green-100', 'text-green-700', 'border', 'border-green-200');
        } else {
            messageDiv.classList.remove('bg-green-100', 'text-green-700', 'border-green-200');
            messageDiv.classList.add('bg-red-100', 'text-red-700', 'border', 'border-red-200');
        }
    }
});
</script>
