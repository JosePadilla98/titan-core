---
import { Cable, SolarPanel } from 'lucide-astro';

export interface Tab {
    id: string;
    label: string;
}

export interface Props {
    tabs: Tab[];
    activeTab?: string;
    id?: string;
}

const { tabs, activeTab = tabs[0]?.id, id = 'tabs-toggle-' + Math.random().toString(36).substr(2, 9) } = Astro.props;
---

<div class="relative flex justify-center mb-12" data-aos="fade-up">
    <div class="relative inline-flex bg-background-light rounded-full shadow-md p-1" id={`${id}-toggle`}>
        {
            tabs.map((tab, index) => (
                <button
                    type="button"
                    class:list={[
                        'cursor-pointer relative z-10 flex items-center gap-2 px-6 py-2 rounded-full font-medium text-sm md:text-lg transition-colors duration-300 tab-button',
                        tab.id === activeTab ? 'text-white' : 'text-foreground/70 hover:text-foreground',
                    ]}
                    data-tab={tab.id}
                    data-toggle-id={id}
                >
                    {index === 0 ? <Cable size={20} /> : <SolarPanel size={20} />}
                    {tab.label}
                </button>
            ))
        }

        {/* Píldora azul que se desliza debajo */}
        <div
            id={`${id}-pill`}
            class="absolute top-1 bottom-1 left-1 bg-primary rounded-full transition-all duration-300"
            style="width: auto;"
        >
        </div>
    </div>
</div>

<script define:vars={{ toggleId: id }}>
    document.addEventListener('DOMContentLoaded', function () {
        const tabButtons = document.querySelectorAll(`.tab-button[data-toggle-id="${toggleId}"]`);
        const activePill = document.getElementById(`${toggleId}-pill`);
        const tabPanels = document.querySelectorAll(`.tab-panel[data-toggle-id="${toggleId}"]`);

        // Función para mover la píldora al botón activo
        function movePillTo(button) {
            const { offsetLeft, offsetWidth } = button;
            if (activePill) {
                activePill.style.transform = `translateX(${offsetLeft}px)`;
                activePill.style.width = `${offsetWidth}px`;
            }
        }

        // Inicializar en el primer botón
        if (tabButtons.length > 0) {
            movePillTo(tabButtons[0]);
        }

        // Cambiar entre tabs
        function switchTab(tabId) {
            tabButtons.forEach((button) => {
                if (button.getAttribute('data-tab') === tabId) {
                    button.classList.add('text-white');
                    button.classList.remove('text-foreground/70', 'hover:text-foreground');
                    movePillTo(button);
                } else {
                    button.classList.remove('text-white');
                    button.classList.add('text-foreground/70', 'hover:text-foreground');
                }
            });

            tabPanels.forEach((panel) => {
                if (panel.id === 'tab-' + toggleId + '-' + tabId) {
                    panel.classList.remove('hidden');
                    panel.classList.add('block');
                } else {
                    panel.classList.remove('block');
                    panel.classList.add('hidden');
                }
            });
        }

        // Añadir listeners
        tabButtons.forEach((button) => {
            button.addEventListener('click', function () {
                const tabId = this.getAttribute('data-tab');
                if (tabId) switchTab(tabId);
            });
        });
    });
</script>
