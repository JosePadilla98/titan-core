---
import Eyebrow from '@components/ui/Eyebrow.astro';
import type { Feature } from '@data/features';
import type { PaddingSize, ThemeColor } from '@utils/styleUtils';
import { getBackgroundColor, getPaddingClass, getTextColor } from '@utils/styleUtils';
import { Zap } from 'lucide-astro';

export interface Props {
    content: {
        eyebrow?: string;
        title?: string;
        description?: string;
        tabs: {
            id: string;
            label: string;
            features: Feature[];
            columns?: number;
        }[];
        button?: {
            text: string;
            link: string;
            variant?: 'primary' | 'secondary' | 'ghostLight' | 'ghostDark';
        };
    };
    background?: ThemeColor;
    padding?: PaddingSize;
    paddingTop?: PaddingSize;
    paddingBottom?: PaddingSize;
}

const {
    content: { eyebrow, title, description, tabs, button },
    background = 'base',
} = Astro.props;

const bgColor = getBackgroundColor(background);
const textColor = getTextColor(background);
const paddingClass = getPaddingClass({
    padding: Astro.props.padding,
    paddingTop: Astro.props.paddingTop,
    paddingBottom: Astro.props.paddingBottom,
});
---

<section class:list={['relative', bgColor, paddingClass]}>
    <div class="site-container px-4">
        {
            (title || description) && (
                <div class="text-center mb-12 max-w-3xl mx-auto">
                    {eyebrow && <Eyebrow text={eyebrow} background={background} />}
                    {title && (
                        <h2
                            class:list={[
                                'text-transparent bg-clip-text bg-gradient-to-t to-[#1a1f3c] from-[#4b6ed4]',
                                // textColor,
                            ]}
                            data-aos="fade-up"
                        >
                            {title}
                        </h2>
                    )}
                    {description && (
                        <p class:list={['mt-4', textColor, 'opacity-90']} data-aos="fade-up" data-aos-delay="100">
                            {description}
                        </p>
                    )}
                </div>
            )
        }

        {/* Tabs Navigation */}
        {/* Toggle de dos tabs con píldora deslizante */}
        {
            tabs.length === 2 && (
                <div class="relative flex justify-center mb-12" data-aos="fade-up">
                    <div class="relative inline-flex bg-background-light rounded-full shadow-md p-1" id="tabs-toggle">
                        {tabs.map((tab, index) => (
                            <button
                                type="button"
                                class:list={[
                                    'relative z-10 flex items-center gap-2 px-6 py-2 rounded-full font-medium text-lg transition-colors duration-300 tab-button',
                                    index === 0 ? 'text-white' : 'text-foreground/70 hover:text-foreground',
                                ]}
                                data-tab={tab.id}
                            >
                                {index === 0 ? <Zap size={20} /> : <Zap size={20} />}
                                {tab.label}
                            </button>
                        ))}

                        {/* Píldora azul que se desliza debajo */}
                        <div
                            id="active-pill"
                            class="absolute top-1 bottom-1 left-1 bg-primary rounded-full transition-all duration-300"
                            style="width: auto;"
                        />
                    </div>
                </div>
            )
        }

        {/* Tab Content */}
        <div id="tab-content">
            {
                tabs.map((tab, index) => (
                    <div
                        id={`tab-${tab.id}`}
                        class:list={[
                            'grid gap-8 auto-rows-fr tab-panel',
                            tab.columns === 3
                                ? 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3'
                                : 'grid-cols-1 md:grid-cols-2 lg:grid-cols-auto-fit',
                            index === 0 ? 'block' : 'hidden',
                        ]}
                        data-aos="fade-up"
                    >
                        {tab.features.map((feature, featureIndex) => (
                            <div
                                class:list={['p-6 pb-8 rounded-lg bg-background-light shadow-xl', 'flex flex-col']}
                                data-aos="fade-up"
                                data-aos-delay={featureIndex * 100}
                            >
                                <div
                                    class:list={[
                                        'w-12 h-12 flex items-center justify-center rounded-lg mb-4',
                                        'bg-primary',
                                    ]}
                                >
                                    <feature.icon size={24} class="text-white" />
                                </div>
                                <h3 class:list={['text-h4 mb-2', textColor]}>{feature.title}</h3>
                                <p class:list={['text-base', textColor, 'opacity-90']}>{feature.description}</p>
                            </div>
                        ))}
                    </div>
                ))
            }
        </div>

        {
            button && (
                <div class="text-center mt-12" data-aos="fade-up">
                    <a
                        href={button.link}
                        class:list={[
                            'inline-flex items-center px-6 py-3 rounded-lg font-medium transition-colors',
                            button.variant === 'secondary'
                                ? 'bg-secondary text-secondary-foreground hover:bg-secondary/90'
                                : button.variant === 'ghostLight'
                                  ? 'bg-transparent text-white hover:bg-white/10'
                                  : button.variant === 'ghostDark'
                                    ? 'bg-transparent text-foreground hover:bg-foreground/10'
                                    : 'bg-primary text-primary-foreground hover:bg-primary/90',
                        ]}
                    >
                        {button.text}
                    </a>
                </div>
            )
        }
    </div>
</section>

<style>
    .grid-cols-auto-fit {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabButtons = document.querySelectorAll<HTMLButtonElement>('.tab-button');
        const activePill = document.getElementById('active-pill') as HTMLElement | null;
        const tabPanels = document.querySelectorAll<HTMLElement>('.tab-panel');

        // Función para mover la píldora al botón activo
        function movePillTo(button: Element) {
            const { offsetLeft, offsetWidth } = button as HTMLElement;
            if (activePill) {
                activePill.style.transform = `translateX(${offsetLeft}px)`;
                activePill.style.width = `${offsetWidth}px`;
            }
        }

        // Inicializar en el primer botón
        if (tabButtons.length > 0) {
            movePillTo(tabButtons[0]);
        }

        // Cambiar entre tabs
        function switchTab(tabId: string) {
            tabButtons.forEach((button) => {
                if (button.getAttribute('data-tab') === tabId) {
                    button.classList.add('text-white');
                    button.classList.remove('text-foreground/70', 'hover:text-foreground');
                    movePillTo(button);
                } else {
                    button.classList.remove('text-white');
                    button.classList.add('text-foreground/70', 'hover:text-foreground');
                }
            });

            tabPanels.forEach((panel) => {
                if (panel.id === 'tab-' + tabId) {
                    panel.classList.remove('hidden');
                    panel.classList.add('block');
                } else {
                    panel.classList.remove('block');
                    panel.classList.add('hidden');
                }
            });
        }

        // Añadir listeners
        tabButtons.forEach((button) => {
            button.addEventListener('click', function (this: HTMLButtonElement) {
                const tabId = this.getAttribute('data-tab');
                if (tabId) switchTab(tabId);
            });
        });
    });
</script>
