---
import Eyebrow from '@components/ui/Eyebrow.astro';
import ToggleTabs from '@components/ui/ToggleTabs.astro';
import type { Feature } from '@data/features';
import { COOL_TEXT_STYLE } from '@utils/styleUtils';
import type { PaddingSize, ThemeColor } from '@utils/styleUtils';
import { getBackgroundColor, getPaddingClass, getTextColor } from '@utils/styleUtils';

export interface Props {
    content: {
        eyebrow?: string;
        title?: string;
        description?: string;
        tabs: {
            id: string;
            label: string;
            features: Feature[];
            columns?: number;
        }[];
        button?: {
            text: string;
            link: string;
            variant?: 'primary' | 'secondary' | 'ghostLight' | 'ghostDark';
        };
    };
    background?: ThemeColor;
    padding?: PaddingSize;
    paddingTop?: PaddingSize;
    paddingBottom?: PaddingSize;
}

const {
    content: { eyebrow, title, description, tabs, button },
    background = 'base',
} = Astro.props;

const bgColor = getBackgroundColor(background);
const textColor = getTextColor(background);
const paddingClass = getPaddingClass({
    padding: Astro.props.padding,
    paddingTop: Astro.props.paddingTop,
    paddingBottom: Astro.props.paddingBottom,
});
---

<section class:list={['relative overflow-hidden', bgColor, paddingClass]}>
    <div class="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-secondary/5"></div>
    <div class="site-container px-4 relative z-10">
        {
            (title || description) && (
                <div class="text-center mb-16 max-w-4xl mx-auto">
                    {eyebrow && <Eyebrow text={eyebrow} background={background} data-aos="fade-up" />}
                    {title && (
                        <h2 class:list={[COOL_TEXT_STYLE, 'font-bold']} data-aos="fade-up" data-aos-delay="100">
                            <span class="bg-clip-text text-transparent">{title}</span>
                        </h2>
                    )}
                    {description && (
                        <p
                            class:list={['mt-6 text-lg lg:text-xl', textColor, 'opacity-90 leading-relaxed']}
                            data-aos="fade-up"
                            data-aos-delay="200"
                        >
                            {description}
                        </p>
                    )}
                </div>
            )
        }

        {/* Tabs Navigation */}
        {tabs.length === 2 && <ToggleTabs tabs={tabs} id="tabs" />}

        {/* Tab Content */}
        <div id="tab-content">
            {
                tabs.map((tab, index) => (
                    <div
                        id={`tab-tabs-${tab.id}`}
                        class:list={[
                            'grid gap-8 auto-rows-fr tab-panel',
                            tab.columns === 3
                                ? 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3'
                                : 'grid-cols-1 md:grid-cols-2 lg:grid-cols-auto-fit',
                            index === 0 ? 'block' : 'hidden',
                        ]}
                        data-toggle-id="tabs"
                        data-aos="fade-up"
                    >
                        {tab.features.map((feature, featureIndex) => (
                            <div
                                class:list={[
                                    'cursor-pointer group relative p-6 pb-8 rounded-2xl bg-background-light shadow-xl hover:shadow-2xl transition-all duration-500 transform hover:scale-105 hover:-translate-y-2 flex flex-col overflow-hidden',
                                ]}
                                data-aos="fade-up"
                                data-aos-delay={featureIndex * 150 + 200}
                            >
                                <div class="absolute inset-0 bg-gradient-to-br from-primary/5 to-secondary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                                <div class="relative z-10">
                                    <div class="flex justify-center mb-6 relative">
                                        <div class="absolute inset-0 bg-gradient-to-r from-primary/20 to-secondary/20 rounded-full blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 scale-150" />
                                        <div
                                            class:list={[
                                                'relative w-14 h-14 flex items-center justify-center rounded-2xl transition-all duration-500 group-hover:scale-110 group-hover:rotate-3',
                                                'bg-primary shadow-lg',
                                            ]}
                                        >
                                            <feature.icon size={28} class="text-white drop-shadow-lg" />
                                        </div>
                                    </div>
                                    <h3
                                        class:list={[
                                            'text-h4 mb-3 font-bold transition-colors duration-300 group-hover:text-primary',
                                            textColor,
                                        ]}
                                    >
                                        {feature.title}
                                    </h3>
                                    <p
                                        class:list={[
                                            'text-base leading-relaxed transition-opacity duration-300 group-hover:opacity-100',
                                            textColor,
                                            'opacity-90',
                                        ]}
                                    >
                                        {feature.description}
                                    </p>
                                </div>
                            </div>
                        ))}
                    </div>
                ))
            }
        </div>

        {
            button && (
                <div class="text-center mt-16 lg:mt-20" data-aos="fade-up" data-aos-delay="300">
                    <a
                        href={button.link}
                        class:list={[
                            'group relative inline-flex items-center px-8 py-4 rounded-2xl font-bold text-lg transition-all duration-500 transform hover:scale-105 hover:-translate-y-1 shadow-lg hover:shadow-xl',
                            button.variant === 'secondary'
                                ? 'bg-secondary text-secondary-foreground hover:bg-secondary/90'
                                : button.variant === 'ghostLight'
                                  ? 'bg-transparent text-white hover:bg-white/10 border border-white/20'
                                  : button.variant === 'ghostDark'
                                    ? 'bg-transparent text-foreground hover:bg-foreground/10 border border-foreground/20'
                                    : 'bg-gradient-to-r from-primary to-secondary text-white hover:from-primary/90 hover:to-secondary/90',
                        ]}
                    >
                        <span class="relative z-10">{button.text}</span>
                        <div class="absolute inset-0 bg-gradient-to-r from-primary/20 to-secondary/20 rounded-2xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                    </a>
                </div>
            )
        }
    </div>
</section>

<style>
    .grid-cols-auto-fit {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
</style>
